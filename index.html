<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>HVAC Quote Form</title>
<style>
:root{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
body{margin:24px;background:#0b0c10;color:#e8e8e8}
.card{max-width:900px;margin:0 auto;background:#12141a;padding:24px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
h1{margin:0 0 12px;font-size:24px}.desc{margin:0 0 20px;color:#b9c0cb}
form{display:grid;gap:16px}.row{display:grid;gap:8px}.row.inline{grid-template-columns:1fr auto;align-items:center}
label{font-weight:600}input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #2a2f3a;background:#0f1116;color:#e8e8e8}
input[type=range]{padding:0}.hint{font-size:12px;color:#9aa3b2}
button{padding:12px 16px;border-radius:12px;border:0;background:#3b82f6;color:#fff;font-weight:700;cursor:pointer}
button:disabled{opacity:.5;cursor:not-allowed}
.result{margin-top:16px;padding:14px;background:#0f1116;border:1px dashed #2a2f3a;border-radius:12px;white-space:pre-wrap}
.total{font-size:20px;font-weight:800}
.error{margin-top:16px;padding:12px;border-radius:12px;background:#2b1b1b;color:#ffd2d2;border:1px solid #512}
</style>
</head><body>
<div class="card">
  <h1 id="title">Loadingâ€¦</h1>
  <p id="desc" class="desc"></p>
  <div id="err" class="error" style="display:none"></div>
  <form id="form" hidden></form>
  <div id="result" class="result" hidden></div>
</div>

<!-- ðŸ‘‡ PASTE YOUR JSON BETWEEN THESE TAGS (must be VALID JSON) -->
import React, { useMemo, useState } from "react";

/**
 * HVAC Quote Builder â€“ v3 (dependencyâ€‘free)
 * Adds warranty, permit, and miscellaneous direct costs.
 * Price formula: P = D / (1 - C - F - M)
 */

// ---- Embedded data (from your spreadsheets) ----
const DEFAULT_DATA = {
  installers: [
    { name: 'Gregory', base_rate: 40.0, loaded_rate: 59.57 },
    { name: 'Garrett', base_rate: 35.0, loaded_rate: 53.28 },
    { name: 'Chase', base_rate: 32.0, loaded_rate: 49.51 },
    { name: 'Colin', base_rate: 30.0, loaded_rate: 46.99 },
    { name: 'Frank', base_rate: 23.0, loaded_rate: 38.18 },
    { name: 'Angelo', base_rate: 20.0, loaded_rate: 34.41 },
    { name: 'TJ', base_rate: 21.0, loaded_rate: 35.67 },
    { name: 'Tyler', base_rate: 18.0, loaded_rate: 31.89 },
  ],
  furnaces: [
    { model: 'ARVT960403BN', total_cost: 1991.18 },
    { model: 'ARVT960603BN', total_cost: 2056.18 },
    { model: 'ARVT960803BN', total_cost: 2359.18 },
    { model: 'ARVT960804CN', total_cost: 2403.18 },
    { model: 'ARVT961005CN', total_cost: 2584.18 },
    { model: 'ARVT961005DN', total_cost: 2669.18 },
    { model: 'ARVT961205DN', total_cost: 2698.18 },
  ],
  acs: [
    { model: 'AX6VSS1810', total_cost: 2024.15 },
    { model: 'AX6VSS2410', total_cost: 2096.15 },
    { model: 'AX6VSS3010', total_cost: 2186.15 },
    { model: 'AX6VSS3610', total_cost: 2359.47 },
    { model: 'AX6VSS4210', total_cost: 2501.47 },
    { model: 'AX6VSS4810', total_cost: 2642.47 },
    { model: 'AX6VSS6010', total_cost: 2970.47 },
  ],
  coils: [
    { model: 'CAPEA2418B3', total_cost: null },
    { model: 'CAPEA3022B3', total_cost: null },
    { model: 'CAPEA3626B3', total_cost: null },
    { model: 'CAPEA3626C3', total_cost: null },
    { model: 'CAPEA4830C3', total_cost: null },
    { model: 'CAPEA4830D3', total_cost: null },
    { model: 'CAPEA6030D3', total_cost: null },
  ],
  financingPlans: [
    { name: '5 Year - 9.99', percent: 0.0625 },
    { name: '10 Year - 9.99', percent: 0.0675 },
    { name: '12 Month No Promo', percent: 0.055 },
    { name: '3 Year Equal Pay', percent: 0.1875 },
    { name: 'Credit Card', percent: 0.03 },
    { name: 'Check/Cash', percent: 0.0 },
  ],
};

const Box = ({ title, children }) => (
  <div className="rounded-2xl border border-neutral-200 bg-white p-4 shadow-sm">
    {title && <div className="mb-2 text-sm font-semibold tracking-tight">{title}</div>}
    {children}
  </div>
);

const Row = ({ label, value, bold }) => (
  <div className="flex items-center justify-between text-sm py-0.5">
    <div className="opacity-70">{label}</div>
    <div className={bold ? 'font-semibold' : ''}>{value}</div>
  </div>
);

function currency(n) {
  const v = Number.isFinite(n) ? n : 0;
  return v.toLocaleString(undefined, { style: 'currency', currency: 'USD' });
}

function num(v) {
  const n = typeof v === 'string' ? parseFloat(v) : v;
  return Number.isFinite(n) ? n : 0;
}

export default function App() {
  const [data, setData] = useState(DEFAULT_DATA);
  const [installers, setInstallers] = useState([
    { name: '', hours: '' },
    { name: '', hours: '' },
    { name: '', hours: '' },
    { name: '', hours: '' },
  ]);
  const [globalHours, setGlobalHours] = useState(8);
  const [furnace, setFurnace] = useState('');
  const [ac, setAc] = useState('');
  const [coil, setCoil] = useState('');

  // direct cost adders
  const [thermostat, setThermostat] = useState(0);
  const [warrantyCost, setWarrantyCost] = useState(0);
  const [permitFee, setPermitFee] = useState(0);
  const [miscCost, setMiscCost] = useState(0);

  const [commissionPct, setCommissionPct] = useState(4); // 2â€“10
  const [financingName, setFinancingName] = useState(data.financingPlans[0]?.name ?? 'Check/Cash');
  const [marginPct, setMarginPct] = useState(50); // 40â€“60
  const [showData, setShowData] = useState(false);
  const [dataText, setDataText] = useState(JSON.stringify(DEFAULT_DATA, null, 2));

  const instMap = useMemo(() => Object.fromEntries(data.installers.map(i => [i.name, i])), [data]);
  const fMap = useMemo(() => Object.fromEntries(data.furnaces.map(i => [i.model, i.total_cost ?? 0])), [data]);
  const aMap = useMemo(() => Object.fromEntries(data.acs.map(i => [i.model, i.total_cost ?? 0])), [data]);
  const cMap = useMemo(() => Object.fromEntries(data.coils.map(i => [i.model, i.total_cost ?? 0])), [data]);
  const financePct = useMemo(() => (data.financingPlans.find(p => p.name === financingName)?.percent ?? 0), [data, financingName]);

  // costs
  let labor = 0;
  installers.forEach((slot) => {
    if (!slot.name) return;
    const r = instMap[slot.name]?.loaded_rate ?? 0;
    const h = slot.hours !== '' ? num(slot.hours) : num(globalHours);
    labor += r * h;
  });
  const equip = (fMap[furnace] || 0) + (aMap[ac] || 0) + (cMap[coil] || 0);
  const D = labor + equip + num(thermostat) + num(warrantyCost) + num(permitFee) + num(miscCost);

  const C = commissionPct / 100;
  const F = financePct;
  const M = marginPct / 100;
  const denom = 1 - C - F - M;
  const price = denom > 0 ? D / denom : NaN;

  const commission$ = Number.isFinite(price) ? price * C : NaN;
  const financing$  = Number.isFinite(price) ? price * F : NaN;
  const gm$         = Number.isFinite(price) ? price * M : NaN;
  const cogs$       = Number.isFinite(price) ? price - gm$ : NaN;

  const reset = () => {
    setInstallers([{name:'',hours:''},{name:'',hours:''},{name:'',hours:''},{name:'',hours:''}]);
    setGlobalHours(8);
    setFurnace(''); setAc(''); setCoil('');
    setThermostat(0); setWarrantyCost(0); setPermitFee(0); setMiscCost(0);
    setCommissionPct(4);
    setFinancingName(data.financingPlans[0]?.name ?? 'Check/Cash');
    setMarginPct(50);
  };

  const tryLoadData = () => {
    try {
      const parsed = JSON.parse(dataText);
      if (!parsed.installers || !parsed.furnaces || !parsed.acs || !parsed.coils) throw new Error('Missing required keys');
      if (!parsed.financingPlans) parsed.financingPlans = DEFAULT_DATA.financingPlans;
      setData(parsed);
      setShowData(false);
    } catch (e) {
      alert('Invalid JSON: ' + e.message);
    }
  };

  return (
    <div className="min-h-screen bg-stone-50 p-6">
      <div className="mx-auto max-w-6xl space-y-6">
        <div className="flex items-center justify-between">
          <h1 className="text-2xl font-semibold">HVAC Quote Builder</h1>
          <div className="flex gap-2">
            <button className="rounded-xl border px-3 py-2 text-sm" onClick={() => setShowData(true)}>Data</button>
            <button className="rounded-xl border px-3 py-2 text-sm" onClick={reset}>Reset</button>
          </div>
        </div>

        <Box title="Installers">
          <div className="flex items-center gap-3 mb-3">
            <label className="text-sm">Global hours</label>
            <input className="w-24 rounded border px-2 py-1" type="number" min={0} value={globalHours}
                   onChange={e => setGlobalHours(num(e.target.value))} />
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
            {installers.map((slot, idx) => (
              <div key={idx} className="grid grid-cols-12 items-center gap-2 rounded-xl border p-3">
                <div className="col-span-6">
                  <div className="text-xs mb-1">Installer {idx+1}</div>
                  <select className="w-full rounded border px-2 py-2" value={slot.name}
                          onChange={e => {
                            const next = installers.slice();
                            next[idx] = { ...next[idx], name: e.target.value };
                            setInstallers(next);
                          }}>
                    <option value="">â€” Select installer â€”</option>
                    {data.installers.map(i => (
                      <option key={i.name} value={i.name}>{i.name} â€” ${i.base_rate}/hr Â· Loaded ${i.loaded_rate}/hr</option>
                    ))}
                  </select>
                </div>
                <div className="col-span-3">
                  <div className="text-xs mb-1">Hours (override)</div>
                  <input className="w-full rounded border px-2 py-2" type="number" min={0} value={slot.hours}
                         onChange={e => {
                           const next = installers.slice();
                           next[idx] = { ...next[idx], hours: e.target.value };
                           setInstallers(next);
                         }} />
                </div>
                <div className="col-span-3 text-right text-sm opacity-70">
                  {(() => {
                    if (!slot.name) return 'â€”';
                    const r = instMap[slot.name]?.loaded_rate ?? 0;
                    const h = slot.hours !== '' ? num(slot.hours) : num(globalHours);
                    return currency(r * h);
                  })()}
                </div>
              </div>
            ))}
          </div>
        </Box>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
          <Box title="Furnace">
            <select className="w-full rounded border px-2 py-2" value={furnace} onChange={e => setFurnace(e.target.value)}>
              <option value="">â€” Select furnace â€”</option>
              {data.furnaces.map(x => (
                <option key={x.model} value={x.model}>{x.model} â€” {x.total_cost != null ? `$${x.total_cost}` : 'â€”'}</option>
              ))}
            </select>
          </Box>
          <Box title="AC">
            <select className="w-full rounded border px-2 py-2" value={ac} onChange={e => setAc(e.target.value)}>
              <option value="">â€” Select AC â€”</option>
              {data.acs.map(x => (
                <option key={x.model} value={x.model}>{x.model} â€” {x.total_cost != null ? `$${x.total_cost}` : 'â€”'}</option>
              ))}
            </select>
          </Box>
          <Box title="Coil">
            <select className="w-full rounded border px-2 py-2" value={coil} onChange={e => setCoil(e.target.value)}>
              <option value="">â€” Select coil â€”</option>
              {data.coils.map(x => (
                <option key={x.model} value={x.model}>{x.model} â€” {x.total_cost != null ? `$${x.total_cost}` : 'â€” (0)'} </option>
              ))}
            </select>
          </Box>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
          <Box title="Thermostat ($)">
            <input className="w-full rounded border px-2 py-2" type="number" min={0}
                   value={thermostat} onChange={e => setThermostat(e.target.value)} />
          </Box>
          <Box title="Warranty ($)">
            <input className="w-full rounded border px-2 py-2" type="number" min={0}
                   value={warrantyCost} onChange={e => setWarrantyCost(e.target.value)} />
          </Box>
          <Box title="Permit fee ($)">
            <input className="w-full rounded border px-2 py-2" type="number" min={0}
                   value={permitFee} onChange={e => setPermitFee(e.target.value)} />
          </Box>
          <Box title="Miscellaneous ($)">
            <input className="w-full rounded border px-2 py-2" type="number" min={0}
                   value={miscCost} onChange={e => setMiscCost(e.target.value)} />
          </Box>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
          <Box title={`Commission: ${commissionPct}%`}>
            <input type="range" min={2} max={10} step={0.5} value={commissionPct}
                   onChange={e => setCommissionPct(parseFloat(e.target.value))} className="w-full"/>
          </Box>
          <Box title="Financing plan">
            <select className="w-full rounded border px-2 py-2" value={financingName}
                    onChange={e => setFinancingName(e.target.value)}>
              {data.financingPlans.map(p => (
                <option key={p.name} value={p.name}>{p.name} â€” {(p.percent*100).toFixed(2)}% dealer fee</option>
              ))}
            </select>
          </Box>
          <Box title={`Target Margin: ${marginPct}%`}>
            <input type="range" min={40} max={60} step={1} value={marginPct}
                   onChange={e => setMarginPct(parseFloat(e.target.value))} className="w-full"/>
            <div className="text-xs text-neutral-500 mt-1">Gross margin on final selling price. Price solves after commission + financing.</div>
          </Box>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
          <Box title="Direct Costs">
            <Row label="Labor" value={currency(labor)} />
            <Row label="Equipment (Furn+AC+Coil)" value={currency(equip)} />
            <Row label="Thermostat" value={currency(num(thermostat))} />
            <Row label="Warranty" value={currency(num(warrantyCost))} />
            <Row label="Permit fee" value={currency(num(permitFee))} />
            <Row label="Miscellaneous" value={currency(num(miscCost))} />
            <div className="h-px bg-neutral-200 my-2" />
            <Row label="Total Direct" value={currency(D)} bold />
          </Box>
          <Box title="Built-in Fees">
            <Row label="Commission ($)" value={Number.isFinite(commission$) ? currency(commission$) : 'â€”'} />
            <Row label="Financing ($)" value={Number.isFinite(financing$) ? currency(financing$) : 'â€”'} />
            <Row label="COGS (excl. margin)" value={Number.isFinite(cogs$) ? currency(cogs$) : 'â€”'} />
          </Box>
          <Box title="Final Price">
            {denom <= 0 ? (
              <div className="text-sm text-red-600">Invalid: 1 âˆ’ commission âˆ’ financing âˆ’ margin â‰¤ 0. Reduce one.</div>
            ) : (
              <>
                <div className="text-3xl font-semibold">{currency(price)}</div>
                <Row label="Gross Margin ($)" value={currency(gm$)} />
                <button className="mt-3 w-full rounded-xl border px-3 py-2 text-sm"
                        onClick={() => {
                          const payload = {
                            selections: { installers, furnace, ac, coil, thermostat, warrantyCost, permitFee, miscCost, commissionPct, financingName, marginPct },
                            direct_costs: { labor, equip, thermostat: num(thermostat), warranty: num(warrantyCost), permit: num(permitFee), misc: num(miscCost), total: D },
                            price_breakdown: { price, commission: commission$, financing: financing$, gross_margin: gm$ },
                            generated_at: new Date().toISOString(),
                          };
                          const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
                          const url = URL.createObjectURL(blob);
                          const a = document.createElement('a');
                          a.href = url; a.download = 'quote.json'; a.click();
                          URL.revokeObjectURL(url);
                        }}>Export JSON</button>
              </>
            )}
          </Box>
        </div>

        {showData && (
          <div className="fixed inset-0 bg-black/30 flex items-center justify-center p-4">
            <div className="w-full max-w-3xl rounded-2xl bg-white p-4">
              <div className="mb-2 text-sm font-semibold">Load / Edit Data JSON</div>
              <textarea className="w-full h-72 rounded border p-2 font-mono text-xs" value={dataText}
                        onChange={e => setDataText(e.target.value)} />
              <div className="mt-3 flex justify-end gap-2">
                <button className="rounded-xl border px-3 py-2 text-sm" onClick={() => setShowData(false)}>Cancel</button>
                <button className="rounded-xl border px-3 py-2 text-sm" onClick={tryLoadData}>Load</button>
                <button className="rounded-xl border px-3 py-2 text-sm" onClick={() => setDataText(JSON.stringify(data, null, 2))}>Load current</button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

<!-- ðŸ‘† KEEP IT STRICT: double quotes, no comments, no trailing commas. -->

<script>
const E=(t,a={},...c)=>{const n=document.createElement(t);for(const[k,v]of Object.entries(a)){if(k==="class")n.className=v;else if(k.startsWith("on")&&typeof v==="function")n.addEventListener(k.slice(2),v);else if(v!==undefined&&v!==null)n.setAttribute(k,v)}for(const x of c)n.append(x instanceof Node?x:document.createTextNode(String(x)));return n};
const coerce=(v,t)=>t==="number"||t==="range"?Number(v||0):t==="checkbox"?!!v:(v??"");
const showErr=m=>{const e=document.getElementById('err'); e.style.display='block'; e.textContent=m};
function renderField(f){
  const id=f.name, label=E("label",{for:id},f.label??f.name), hint=f.hint?E("div",{class:"hint"},f.hint):null; let input;
  switch((f.type||"text").toLowerCase()){
    case"select":{
      input=E("select",{id,name:id,required:f.required?true:null});
      const opts=Array.isArray(f.options)?f.options:(f.options&&typeof f.options==="object")?Object.entries(f.options).map(([v,l])=>({value:v,label:l})):[];
      for(const o of opts){const val=typeof o==="string"?o:o.value, txt=typeof o==="string"?o:(o.label??o.value); input.append(E("option",{value:val},txt))}
      if(f.default!==undefined) input.value=f.default; break;
    }
    case"number": case"text":{
      input=E("input",{id,name:id,type:f.type||"text",required:f.required?true:null,min:f.min,max:f.max,step:f.step,placeholder:f.placeholder});
      if(f.default!==undefined) input.value=f.default; break;
    }
    case"range":{
      const out=E("span",{id:id+"_out"},"");
      input=E("input",{id,name:id,type:"range",min:f.min??0,max:f.max??100,step:f.step??1,value:f.default??f.min??0,oninput:()=>out.textContent=input.value});
      setTimeout(()=>input.dispatchEvent(new Event("input")),0);
      return E("div",{class:"row inline"},E("div",{},label,hint??""),E("div",{},input," ",out));
    }
    case"checkbox":{
      input=E("input",{id,name:id,type:"checkbox"}); if(f.default) input.checked=true;
      return E("div",{class:"row inline"},E("div",{},label,hint??""),input);
    }
    default: input=E("input",{id,name:id,type:"text"});
  }
  const wrap=E("div",{class:"row"},label,input); if(hint) wrap.append(hint); return wrap;
}
function collect(form,fields){const v={}; for(const f of fields){const r=form.querySelector(`[name="${f.name}"]`); if(!r) continue; v[f.name]=f.type==="checkbox"?r.checked:coerce(r.value,f.type)} return v}
function calcTotal(cfg,values){const ex=cfg.totalExpression||cfg.formula; if(!ex) return null; try{const fn=new Function("values",ex.startsWith("return")?ex:`return (${ex});`); const r=fn(values); return Number.isFinite(r)?Number(r):r}catch(e){showErr("Total calc error: "+e.message); return null}}
function render(cfg){
  document.getElementById('title').textContent=cfg.title||'Quote Form';
  document.getElementById('desc').textContent=cfg.description||'';
  const form=document.getElementById('form'); form.innerHTML='';
  const fields=(cfg.fields||[]).map(f=>({...f,name:f.name||f.id||crypto.randomUUID()}));
  for(const f of fields) form.append(renderField(f));
  const submit=E('button',{type:'submit'},cfg.submitLabel||'Calculate'); form.append(submit);
  const result=document.getElementById('result'); form.hidden=false;
  form.addEventListener('submit',e=>{
    e.preventDefault();
    const values=collect(form,fields);
    const total=calcTotal(cfg,values);
    result.hidden=false; result.innerHTML='';
    if(total!==null&&total!==undefined){
      result.append(E('div',{class:'total'},'Total: '+new Intl.NumberFormat(undefined,{style:'currency',currency:cfg.currency||'USD'}).format(total)));
    }
    result.append(E('pre',{},JSON.stringify(values,null,2)));
  });
}
try{
  const raw=document.getElementById('cfg').textContent.trim();
  const cfg=JSON.parse(raw);
  render(cfg);
}catch(e){
  document.getElementById('title').textContent='Invalid JSON';
  document.getElementById('desc').textContent='Fix errors below.';
  showErr(e.message);
}
</script>
</body></html>
